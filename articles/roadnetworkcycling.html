<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example: gradients of a road network for a given city • slopes</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example: gradients of a road network for a given city">
<meta property="og:description" content="slopes">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slopes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/slopes.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/benchmark.html">Benchmarking slopes calculation</a>
    </li>
    <li>
      <a href="../articles/roadnetworkcycling.html">Example: gradients of a road network for a given city</a>
    </li>
    <li>
      <a href="../articles/verification.html">Verification of slopes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/itsleeds/slopes/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="roadnetworkcycling_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example: gradients of a road network for a given city</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/itsleeds/slopes/blob/master/vignettes/roadnetworkcycling.Rmd"><code>vignettes/roadnetworkcycling.Rmd</code></a></small>
      <div class="hidden name"><code>roadnetworkcycling.Rmd</code></div>

    </div>

    
    
<p>An example of the demand for data provided by the <code>slopes</code> package is a map showing gradients across São Paulo (Brazil, see image below), with a simplistic classification for cycling difficulty.</p>
<div class="figure">
<img src="https://pbs.twimg.com/media/ErJ2dr8WMAIHwMn?format=jpg&amp;name=small" alt=""><p class="caption">using slopes() to create a road network gradient for cycling for São Paulo (Brazil)</p>
</div>
<p>This vignette will guide through the production of an interactive slope map for a road network, using <code>slopes</code>, <code>osmextract</code>, <code>sf</code>, <code>stplanr</code> and <code>tmap</code>.</p>
<p>For the convenience of sample, we will use <a href="https://en.wikipedia.org/wiki/Isle_of_Wight">Isle of Wight</a> case, with 384 km<sup>2</sup>. See <a href="#other-examples">Other examples</a> below.</p>
<p>This will follow three steps:</p>
<ol style="list-style-type: decimal">
<li>Download of road network from <a href="https://www.openstreetmap.org/">OpenStreetMap</a>
</li>
<li>Prepare the network</li>
<li>Compute slopes and export the map in html</li>
</ol>
<div id="extract-the-osm-network-from-geofabrik" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-the-osm-network-from-geofabrik" class="anchor"></a>Extract the OSM network from geofabrik</h2>
<p>For this step you may use <code>osmextract</code> <a href="https://itsleeds.github.io/osmextract/articles/osmextract.html">package</a> which downloads the most recent information available at OSM (<a href="https://download.geofabrik.de/index.html" class="uri">https://download.geofabrik.de/index.html</a>) and converts to <em>GeoPackage</em> (.gpkg), the equivalent to <em>shapefile</em>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="co"># remotes::install_github("ITSLeeds/osmextract")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmextract/">osmextract</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get the network</span>
<span class="va">iow_osm</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html">oe_get</a></span><span class="op">(</span><span class="st">"Isle of Wight"</span>, provider <span class="op">=</span> <span class="st">"geofabrik"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, 
                 quiet <span class="op">=</span> <span class="cn">FALSE</span>, force_download <span class="op">=</span> <span class="cn">TRUE</span>, force_vectortranslate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># 7 MB</span>
<span class="co">#&gt; 0...10...20...30...40...50...60...70...80...90...100 - done.</span>
<span class="co">#&gt; Reading layer `lines' from data source </span>
<span class="co">#&gt;   `/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/Rtmp7BGclQ/geofabrik_isle-of-wight-latest.gpkg' </span>
<span class="co">#&gt;   using driver `GPKG'</span>
<span class="co">#&gt; Simple feature collection with 47639 features and 9 fields</span>
<span class="co">#&gt; Geometry type: LINESTRING</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -5.715479 ymin: 43.35489 xmax: 1.92832 ymax: 51.16517</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>

<span class="co"># filter the major roads</span>
<span class="va">iow_network</span> <span class="op">=</span> <span class="va">iow_osm</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">highway</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'primary'</span>, <span class="st">"primary_link"</span>, <span class="st">'secondary'</span>,<span class="st">"secondary_link"</span>, 
                               <span class="st">'tertiary'</span>, <span class="st">"tertiary_link"</span>, <span class="st">"trunk"</span>, <span class="st">"trunk_link"</span>, 
                               <span class="st">"residential"</span>, <span class="st">"cycleway"</span>, <span class="st">"living_street"</span>, <span class="st">"unclassified"</span>, 
                               <span class="st">"motorway"</span>, <span class="st">"motorway_link"</span>, <span class="st">"pedestrian"</span>, <span class="st">"steps"</span>, <span class="st">"track"</span><span class="op">)</span><span class="op">)</span> <span class="co">#remove: "service"</span></code></pre></div>
</div>
<div id="clean-the-road-network" class="section level2">
<h2 class="hasAnchor">
<a href="#clean-the-road-network" class="anchor"></a>Clean the road network</h2>
<p>These are optional steps that give better results, although they may slow down the process since they increase the number of segments present in the network.</p>
<div id="filter-the-unconnected-segments" class="section level3">
<h3 class="hasAnchor">
<a href="#filter-the-unconnected-segments" class="anchor"></a>Filter the unconnected segments</h3>
<p>The <a href="https://docs.ropensci.org/stplanr/reference/rnet_group.html"><code>rnet_group()</code></a> function from <code>stplanar</code> package assesses the connectivity of each segment assigns a group number (similar to a clustering process). Then we may filter the main group, the one with more connected segments.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remotes::install_github("ropensci/stplanr")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/stplanr">stplanr</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter unconnected roads</span>
<span class="va">iow_network</span><span class="op">$</span><span class="va">group</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/rnet_group.html">rnet_group</a></span><span class="op">(</span><span class="va">iow_network</span><span class="op">)</span>
<span class="va">iow_network_clean</span> <span class="op">=</span> <span class="va">iow_network</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># the network with more connected segments</span></code></pre></div>
</div>
<div id="break-the-segments-on-vertices" class="section level3">
<h3 class="hasAnchor">
<a href="#break-the-segments-on-vertices" class="anchor"></a>Break the segments on vertices</h3>
<p>A very long segment will have an assigned average slope, but a very long segment can be broken into its nodes and have its own slope in each part of the segment. On one hand, we want the segments to break at their nodes. On the other hand, we don’t want artificial <em>nodes</em> to be created where two lines cross, in particular where they have different <strong>z</strong> levels (<em>eg.</em> <em>brunels</em>: bridges and tunnels).</p>
<p>The <a href="https://docs.ropensci.org/stplanr/reference/rnet_breakup_vertices.html"><code>rnet_breakup_vertices</code></a> from <code>stplanr</code> breaks the segments at their inner vertices, preserving the <strong>brunels</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iow_network_segments</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/rnet_breakup_vertices.html">rnet_breakup_vertices</a></span><span class="op">(</span><span class="va">iow_network_clean</span><span class="op">)</span></code></pre></div>
<p>In this case, there are more 1.59x segments than the original network.</p>
</div>
</div>
<div id="get-slope-values-for-each-segment" class="section level2">
<h2 class="hasAnchor">
<a href="#get-slope-values-for-each-segment" class="anchor"></a>Get slope values for each segment</h2>
<p>For this case we will use <code><a href="../reference/slope_raster.html">slope_raster()</a></code> <a href="https://itsleeds.github.io/slopes/reference/slope_raster.html">function</a>, to retrieve the z values from a digital elevation model. This raster was obtained from STRM NASA mission.</p>
<p>The <strong>SRTM</strong> (<em>Shuttle Radar Topography Mission</em>) NASA’s mission provides <a href="https://gisgeography.com/srtm-shuttle-radar-topography-mission/">freely available</a> worldwide DEM, with a resolution of 25 to 30m and with a vertical accuracy of 16m - <a href="https://www2.jpl.nasa.gov/srtm/">more</a>. The resolution for USA might be better.</p>
<p>Alternatively, <strong>COPERNICUS</strong> ESA’s mission also provides <a href="https://land.copernicus.eu/imagery-in-situ/eu-dem">freely available</a> DEM for all Europe, with a 25m resolution and a vertical accuracy of 7m - <a href="https://land.copernicus.eu/user-corner/publications/eu-dem-flyer/view">more</a>.</p>
<p>Depending of how large is your road network, you can use <code><a href="../reference/slope_3d.html">slope_3d()</a></code> <a href="https://itsleeds.github.io/slopes/reference/slope_3d.html">function</a> - this will require a valid <a href="https://docs.mapbox.com/api/overview/">Mapbox api key</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Import and plot DEM</span>
<span class="va">u</span> <span class="op">=</span> <span class="st">"https://github.com/U-Shift/Declives-RedeViaria/releases/download/0.2/IsleOfWightNASA_clip.tif"</span>
<span class="va">f</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">u</span>, destfile <span class="op">=</span> <span class="va">f</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span>
<span class="va">dem</span> <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>
<span class="co"># res(dem) #27m of resolution</span>
<span class="va">network</span> <span class="op">=</span> <span class="va">iow_network_segments</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">network</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#check if they overlay</span></code></pre></div>
<p><img src="roadnetworkcycling_files/figure-html/import_dem-1.png" width="672" style="display: block; margin: auto;"></p>
<p>All the required data is prepared to estimate the road segments’ gradient.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the slope value for each segment (abs), using slopes package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/itsleeds/slopes/">slopes</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/geodist">geodist</a></span><span class="op">)</span>
<span class="va">network</span><span class="op">$</span><span class="va">slope</span> <span class="op">=</span> <span class="fu"><a href="../reference/slope_raster.html">slope_raster</a></span><span class="op">(</span><span class="va">network</span>, <span class="va">dem</span><span class="op">)</span>
<span class="va">network</span><span class="op">$</span><span class="va">slope</span> <span class="op">=</span> <span class="va">network</span><span class="op">$</span><span class="va">slope</span><span class="op">*</span><span class="fl">100</span> <span class="co">#percentage</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">network</span><span class="op">$</span><span class="va">slope</span><span class="op">)</span> <span class="co">#check the values</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   0.000   1.718   3.073   3.874   5.036 152.888</span></code></pre></div>
<p>Half of the road segments in Isle of Wight have a gradient bellow 3.1%.</p>
<p>We will adopt a simplistic qualitative classification for <strong>cycling effort uphill</strong>, and compare the number of segments in each class.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Classify slopes</span>
<span class="va">network</span><span class="op">$</span><span class="va">slope_class</span> <span class="op">=</span> <span class="va">network</span><span class="op">$</span><span class="va">slope</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cut.html">cut</a></span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="cn">Inf</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-3: flat"</span>, <span class="st">"3-5: mild"</span>, <span class="st">"5-8: medium"</span>, <span class="st">"8-10: hard"</span>, 
               <span class="st">"10-20: extreme"</span>, <span class="st">"&gt;20: impossible"</span><span class="op">)</span>,
    right <span class="op">=</span> <span class="cn">F</span>
  <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">network</span><span class="op">$</span><span class="va">slope_class</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>,<span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       0-3: flat       3-5: mild     5-8: medium      8-10: hard  10-20: extreme </span>
<span class="co">#&gt;            48.7            25.9            16.5             4.2             4.3 </span>
<span class="co">#&gt; &gt;20: impossible </span>
<span class="co">#&gt;             0.4</span></code></pre></div>
<p>It means that <strong>49%</strong> of the roads are flat or almost flat (0-3%) and about <strong>75%</strong> of the roads are easily cyclable (0-5%).</p>
<p>Now let us put this information on a map (see <a href="https://rpubs.com/RobinLovelace/781081">here</a> for interactive version).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># more useful information</span>
<span class="va">network</span><span class="op">$</span><span class="va">length</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_length</a></span><span class="op">(</span><span class="va">network</span><span class="op">)</span>

<span class="co"># make an interactive map</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tmap</span><span class="op">)</span>
<span class="va">palredgreen</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#267300"</span>, <span class="st">"#70A800"</span>, <span class="st">"#FFAA00"</span>, <span class="st">"#E60000"</span>, <span class="st">"#A80000"</span>, <span class="st">"#730000"</span><span class="op">)</span> <span class="co">#color palette</span>
<span class="co"># tmap_mode("view")</span>
<span class="fu">tmap_options</span><span class="op">(</span>basemaps <span class="op">=</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="va">providers</span><span class="op">$</span><span class="va">CartoDB.Positron</span><span class="op">)</span> <span class="co">#basemap</span>

<span class="va">slopemap</span> <span class="op">=</span>
  <span class="fu">tm_shape</span><span class="op">(</span><span class="va">network</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">tm_lines</span><span class="op">(</span>
    col <span class="op">=</span> <span class="st">"slope_class"</span>,
    palette <span class="op">=</span> <span class="va">palredgreen</span>,
    lwd <span class="op">=</span> <span class="fl">2</span>, <span class="co">#line width</span>
    title.col <span class="op">=</span> <span class="st">"Slope [%]"</span>,
    popup.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Highway"</span> <span class="op">=</span> <span class="st">"highway"</span>,
                   <span class="st">"Length"</span> <span class="op">=</span> <span class="st">"length"</span>,
                  <span class="st">"Slope: "</span> <span class="op">=</span> <span class="st">"slope"</span>,
                  <span class="st">"Class: "</span> <span class="op">=</span> <span class="st">"slope_class"</span><span class="op">)</span>,
    popup.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
    <span class="co"># id = "slope"</span>
    id <span class="op">=</span> <span class="st">"name"</span> <span class="co">#if it gets too memory consuming, delete this line</span>
  <span class="op">)</span>

<span class="va">slopemap</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#export to html</span>
<span class="fu">tmap_save</span><span class="op">(</span><span class="va">slopemap</span>, <span class="st">"html/SlopesIoW.html"</span><span class="op">)</span> 

<span class="co"># export information as geopackage</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write</a></span><span class="op">(</span><span class="va">network</span>, <span class="st">"shapefiles/SlopesIoW.gpkg"</span>, append<span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<div id="result" class="section level4">
<h4 class="hasAnchor">
<a href="#result" class="anchor"></a>Result:</h4>
<p><img src="https://user-images.githubusercontent.com/1825120/121820334-2435f080-cc8a-11eb-962c-79dcba97e459.png"></p>
<ul>
<li><a href="http://web.tecnico.ulisboa.pt/~rosamfelix/gis/declives/SlopesIoW.html">Isle of Wight (UK)</a></li>
</ul>
</div>
</div>
<div id="other-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#other-examples" class="anchor"></a>Other examples</h2>
<ul>
<li><a href="http://web.tecnico.ulisboa.pt/~rosamfelix/gis/declives/DeclivesSaoPaulo.html">São Paulo (Brazil)</a></li>
<li><a href="http://web.tecnico.ulisboa.pt/~rosamfelix/gis/declives/DeclivesLisboa.html">Lisbon (Portugal)</a></li>
<li><a href="http://web.tecnico.ulisboa.pt/~rosamfelix/gis/declives/DeclivesPorto_EU.html">Oporto (Portugal)</a></li>
<li>Bristol (UK)</li>
<li>Sheffield (UK)</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Robin Lovelace, Joey Talbot, Rosa Félix.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
