---
# title: "slopes: a package for calculating slopes<br>üìàüé¢üóªüõ£Ô∏è"
title: "slopes: a package for calculating slopes "
subtitle: "üìà of roads, rivers and other linear (simple) features üìâ"  
author: "Robin Lovelace & Rosa F√©lix, UseR 2021<br><br><br><br><br><br><br><br><br><br>"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
---

```{r, eval=FALSE, echo=FALSE}
# to run these slides locally:
xaringan::inf_mr("data-raw/slides.Rmd")
```

```{r xaringanExtra, echo=FALSE}
# From https://github.com/gadenbuie/xaringanExtra
xaringanExtra::use_xaringan_extra(c("tile_view", "animate_css", "tachyons"))
```


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width=9, fig.height=3.5, fig.retina=3,
  out.width = "100%",
  cache = FALSE,
  echo = TRUE,
  message = FALSE, 
  warning = FALSE,
  fig.show = TRUE,
  hiline = TRUE
)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  title_slide_background_color = "#FFFFFF",
  title_slide_background_size = "100%",
  title_slide_background_image = "https://user-images.githubusercontent.com/1825120/121391204-04c75c80-c946-11eb-8d46-ab5d8ada55c2.png",
  title_slide_background_position = "bottom",
  title_slide_text_color = "#080808",
  primary_color = "#080808",
  secondary_color = "#FF961C",
  inverse_header_color = "#FFFFFF"
)
```

background-image: url(https://camo.githubusercontent.com/30a3b814dd72aef5b51db635f2ab6e1b6b6c57b856d239822788967a4932d655/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f45724a32647238574d414948774d6e3f666f726d61743d6a7067266e616d653d6c61726765)
background-position: center
background-size: 100%

--
<br>

# Contents:

## Why slopes?

--

## Key functions

--

## Future plans

--

---

# Why we developed the slopes package

.left-column[

- Real world problems to solve involving slopes
- Existing tools were not up to the job
  - Expensive and hard to reproduce findings (ESRI's 3D analyst)
  - Hard to scale-up (online services)

- R programming challenge

]

--

.right-column[

Real world problem: infrastructure prioritisation. Source: [paper](https://www.jtlu.org/index.php/jtlu/article/view/862) and www.pct.bike

![](https://user-images.githubusercontent.com/1825120/123165723-805bfa00-d46c-11eb-8446-969ea69e0287.png)

]

???

- Rosa motivation

---

## How the package works

Key functions:

1. 

---


.pull-left[

###  Worked example


Load packages

```{r}
# Get linear features you want the gradients of
# See vignette: https://itsleeds.github.io/slopes/articles/roadnetworkcycling.html 
library(slopes)
library(dplyr)
library(sf)
# remotes::install_github("ITSLeeds/osmextract")
library(osmextract) # see UseR talk on osmextract package
library(tmap)
network = oe_get("Isle of Wight", vectortranslate_options = c("-where", "highway IS NOT NULL")) 
```

]

.pull-right[

```{r, fig.height=9}
u = "https://github.com/U-Shift/Declives-RedeViaria/releases/download/0.2/IsleOfWightNASA_clip.tif"
f = basename(u) # Get digital elevation data
download.file(url = u, destfile = f, mode = "wb")
dem = raster::raster(f)
library(raster)
plot(dem)
plot(sf::st_geometry(network), add = TRUE) #check if they overlay
```


]

---

## Calculating slopes

```{r}
sys_time = system.time({
  network$slope = slope_raster(network, dem)
})
nrow(network) / sys_time[3]

network$slope = network$slope * 100 # percentage
summary(network$slope) # check the values
```

---

## Steep segments

```{r}
steep_segment = network %>% 
  filter(slope > 100)
mapview::mapview(steep_segment)
```





---

# Transport planning

---

# River/flooding research

---

# Civil engineering

---

background-image: url(https://raw.githubusercontent.com/ITSLeeds/slopes/master/man/figures/README-slope-vis-1.png)
background-size: 70%
background-position: bottom

# Key functions

---

# Next slide title

---

background-image: url("https://www.thestar.co.uk/jp-ct.co.uk/image/onecms:9b91244b-bef9-44d5-af34-56943ea0a809:1bd497fc-203b-4814-8905-1268a2c6c2a5/NSST-16-01-20-blake-NMSYupload.jpeg?&width=1200")

# Future plans

--

Blake Street, Sheffield. Source: [thestar.co.uk](https://www.thestar.co.uk/news/people/which-sheffields-steepest-street-these-are-ones-you-think-are-worst-1368220)

---

## Estimating slopes of bridges

```{r, out.width="80%", fig.show='hold', echo=FALSE}
knitr::include_graphics(c(
  "slope-edinburgh-bridge.png"
  # "slope-edinburgh-bridge2.png"
))
```


???

- RL

- My research into tools for prioritising cycling investment

- UK not very hilly but models fail slightly in hilly areas

---

```{r, out.width="80%", fig.show='hold', echo=FALSE}
knitr::include_graphics(c(
  # "slope-edinburgh-bridge.png",
  "slope-edinburgh-bridge2.png"
))
```



# Thanks!

Slides created via the R packages:

[**xaringan**](https://github.com/yihui/xaringan)<br>
[gadenbuie/xaringanthemer](https://github.com/gadenbuie/xaringanthemer)

The chakra comes from [remark.js](https://remarkjs.com), [**knitr**](http://yihui.name/knitr), and [R Markdown](https://rmarkdown.rstudio.com).
