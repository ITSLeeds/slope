---
title: "Get started"
output: bookdown::html_vignette2
vignette: >
  %\VignetteIndexEntry{Get started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: slope-references.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Installation
(again)

## Functions 

### Elevation

elevation_add() Take a linestring and add a third dimension (z) to its coordinates
elevation_get() Get elevation data from hosted maptile services
elevation_extract() Extract elevations from coordinates

z_value() retrieves elevation values for each z (as vector of sequential vertices)
z_start() retrieves the elevation value of the first linestring vertice
z_end() retrieves the elevation value of the last linestring vertice
z_mean() retrieves the elevation mean value 
z_max()  retrieves the elevation max value 
z_min()  retrieves the elevation min value 

### Distance

sequential_dist() Calculate the sequential distances between sequential coordinate pairs

### Slope

slope_vector() calculates the slopes associated with consecutive elements in one dimensional distance and associated elevations.
slope_distance() calculates the slopes associated with consecutive distances and elevations.
slope_distance_mean() calculates the mean average slopes associated with consecutive distances and elevations.
slope_distance_weighted() calculates the slopes associated with consecutive distances and elevations, with the mean value associated with each set of distance/elevation vectors weighted in proportion to the distance between each elevation measurement, so longer sections have proportionally more influence on the resulting gradient estimate.

slope_raster() Calculate slopes of linestrings based on local raster map
slope_matrix() Calculate the gradient of line segments from a 3D matrix of coordinates
slope_matrix_weighted() Calculate the weighted gradient of line segments from a 3D matrix of coordinates

slope_xyz() Calculates the slope associated with linestrings that have xyz coordinates

### Plot

plot_dz() Plot a digital elevation profile based on xyz data
plot_slope() Plots the slope profile associated with a linestring with base R graphics

## Datasets

The key input datasets are:
    linestrings representing roads
    single linestring
https://itsleeds.github.io/slopes/reference/lisbon_road_segment.html
https://itsleeds.github.io/slopes/reference/cyclestreets_route.html
lisbon_route
road network
https://itsleeds.github.io/slopes/reference/lisbon_road_segments.html
https://itsleeds.github.io/slopes/reference/magnolia_xy.html

digital elevation model
https://itsleeds.github.io/slopes/reference/dem_lisbon_raster.html



## Examples

One example for a single linestring

```{r, eval=FALSE, echo=FALSE}
start_coords = stplanr::geo_code("bramley park")
end_coods = stplanr::geo_code("university of leeds")
rj = cyclestreets::journey(from = start_coords, to = end_coods)
mapview::mapview(rj)

rj_3d = elevation_add(rj)
plot_slope(rj_3d)
plot(cumsum(rj$distances), cumsum(rj$elevation_change))
```

Adding the Z dimension

lisbon_route
lisbon_route_slopes = slope_3d(routes = lisbon_route, dem = slopes::dem_lisbon_raster)
lisbon_route_slopes


from local raster:
routes = lisbon_road_segments
dem = dem_lisbon_raster
routes$slope = slope_raster(routes, dem)

get from mapbox + get from local raster

### Find slopes when you don't have a DEM

usethis::edit_r_environ()
MAPBOX_API_KEY=xxxxx

 plot viz
plot_slope(lisbon_route_slopes)

One example for small network

see vignettes
